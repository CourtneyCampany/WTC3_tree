---
title: "Sun v Shade leaves (WTCIII)"
author: "Court Campany"
date: "March 17, 2015"
output: html_document
---

```
This set of figures attempts to show that sun and shade leaves were different on multiple levels.  
```

```{r, results='asis', echo=FALSE}
library(knitr)
opts_knit$set(root.dir = '../')
```


ACI curves were measured at saturating light for both sun and shade leaves.  

```{r, results='asis', echo=FALSE, message=FALSE}
library(xtable)

aci_leaf <- read.csv("calculated_data/tdl_aci.csv")

# aci_table <- xtable(aci_leaf)
# digits(aci_table)[c(3,5:6)] <- 3
# digits(aci_table)[c(4)] <- 4
# print(aci_table, type='html', include.rownames=F,hline.after=NULL)
# print(aci_table,  type='html', include.rownames=F, comment=FALSE)
      

 kable(aci_leaf, row.names=NA, digits=2,format = "html")


```


```
Here are some predicted ACI curves for sun/shade with temperature treatements.  Both Vcmax and Jmax are reduced in shade leaves with little effect of treatment. Aci curves were only taken once towards the end of the experiment on well watered trees.
```
```{r,  echo=FALSE, fig.align='center', message=FALSE, warning=FALSE}

source("functions and packages/functions.R")
source("master_scripts/plot_objects.R")
aci_leaf <- read.csv("calculated_data/tdl_aci.csv")

#simulated curves
  library(plantecophys)

  #simulate ACi curves for each leaf, ambient and elevated T
  sunAT_sim <- Aci(Ci=seq(50,1000,length=101), Vcmax=aci_leaf[3,3], Jmax=aci_leaf[3,4],PPFD=1408)
  sunET_sim <- Aci(Ci=seq(50,1000,length=101), Vcmax=aci_leaf[4,3], Jmax=aci_leaf[4,4], PPFD=1408)
  shaAT_sim <- Aci(Ci=seq(50,1000,length=101), Vcmax=aci_leaf[1,3], Jmax=aci_leaf[1,4], PPFD=375)
  shaET_sim <- Aci(Ci=seq(50,1000,length=101), Vcmax=aci_leaf[2,3], Jmax=aci_leaf[2,4],PPFD=375)

#plot
plot(sunAT_sim$Ci, sunAT_sim$ALEAF, col="forestgreen", pch=21,  cex=1.1,xlab=cilab, ylab="", type="l", lwd=2)
  points(sunET_sim$Ci, sunET_sim$ALEAF, col="forestgreen", pch=21,  cex=1.1,xlab="Ci", ylab="", type="l", lwd=2, lty=2)
  points(shaAT_sim$Ci, shaAT_sim$ALEAF, col="yellowgreen", pch=21,  cex=1.1,xlab="Ci", ylab="", type="l", lwd=2)
  points(shaET_sim$Ci, shaET_sim$ALEAF, col="yellowgreen", pch=21,  cex=1.1,xlab="Ci", ylab="", type="l", lwd=2, lty=2)
  legend("bottomright", leglab2, lty=c(1,2,1,2), lwd=2,col=colaci, pt.bg=col4,inset = 0.03)
  title(ylab=satlab, mgp=ypos)


```

```
This figure shows the relationship between leaf N on an area basis and carbon isotope dicrimination between leaf types.
```
```{r, echo=FALSE,fig.align='center', message=FALSE}
source("master_scripts/plot_objects.R")
leaftraits <- read.csv("calculated_data/leaftraits_summary.csv")
##this has droughtleaves

palette(c("yellowgreen", "green4"))

plot(c13.mean ~ leafN_area.mean, data=leaftraits, pch=16, col=as.factor(leaf), ylim=c(-35,-25), 
                 xlim=c(1,3.5), cex=1.25, xlab=narealab, ylab=c13lab)
legend("bottomright", leaflab, pch=16, col=c("yellowgreen", "green4"),pt.cex=1.5,inset = 0.03)  

```

Next I show the light environment in which gas exchange measurements for sun and shade leaves were measured.  This data was generated with a handheld par sensor for each individual leaf level and verified with ceptometer readings within at the height of the measured leaf. There was on average a ~75 reduction in PPFD from sun to shave leaves.

The second figure shows leaf mass area for each gas exchange campaign.  Here there 

```{r,echo=FALSE,fig.align='center',message=FALSE, warning=FALSE}
source("functions and packages/functions.R")
source("master_scripts/plot_objects.R")
library(doBy)
####PPFD-----------------------------------------------------------------------------------------------
par <- read.csv("raw data/par.csv")
treatments <- read.csv("raw data/chamber_trt.csv")

#format function
par<- parformat(par)

par_leaf <- subset(par, ID !="shade-high")
Morder <- c("Oct", "Dec", "Jan", "Feb", "Mar", "Apr")

#data format for bar
parbar <- subset(par_leaf, select = c("par", "month", "leaf_type"))
parbar$month <- factor(parbar$month, levels = Morder)


bar(par, c(leaf_type, month), parbar, col=c("yellowgreen", "green4"), xlab="", ylab="", ylim=c(0, 2000), 
    half.errbar=FALSE)
title(ylab=parlab, mgp=ypos)



###LMA--------------------------------------------------------------------------------------------------
lma <- read.csv("calculated_data/leaf_chemistry.csv")

#data format for bar
lmabar <- subset(lma, select = c("lma", "Month", "leaf"))
  lmabar$Month <- factor(lmabar$Month, levels = Morder)

bar(lma, c(leaf, Month), lmabar, col=c("yellowgreen", "green4"), xlab="", ylab="", ylim=c(0, 185), half.errbar=FALSE)
title(ylab=lmalab, mgp=ypos)

##table summ by treatment
  lma_agg <- summaryBy(lma~ leaf+temp+drydown, data=lma, FUN=c(mean,se))
  lma_agg2 <- summaryBy(lma~ leaf+temp, data=lma, FUN=c(mean,se))
  
  lma_table <- xtable(lma_agg2)

```


## Mesophyll Conducatnce

```{r,echo=FALSE,fig.align='center',message=FALSE, warning=FALSE}
source("master_scripts/plot_objects.R")
source("functions and packages/functions.R")
library(doBy)

gmes <- read.csv("calculated_data/gmes_WTC.csv")

###for analysis first subset well watered and drought treatments
gm_drought <- gmes[gmes$drydown == "drought",]

gm_water <- gmes[gmes$drydown == "control",]
#write.csv(gm_water, "calculated_data/gmes_wellwatered.csv", row.names=FALSE)

palette(c("blue", "red"))

###drought----------------------------------------------------------------------------------------------------

##plots
plot(Photo~gm, data=gm_drought, subset=leaflight=="sun-high", pch=16, col=temp, ylim=c(0,25), xlim=c(0, .5))
  points(Photo~gm, data=gm_drought, subset=leaflight=="shade-low",pch=1, col=temp)
  legend("topright", templab, pch=16,inset = 0.03, col=palette()) 



###well watered------------------------------------------------------------------------------------------------

##sun-shade
plot(Photo~gm, data=gm_water, subset=leaflight=="sun-high", pch=16, col=temp, ylim=c(0,25), xlim=c(0,.5), 
     xlab=gmlab, ylab="")
points(Photo~gm, data=gm_water, subset=leaflight=="shade-low",pch=1, col=temp)
legend("topright", templab, pch=16,inset = 0.03, col=palette()) 
title(ylab=satlab, mgp=ypos, cex=1.2)

##shade low-high
plot(Photo~gm, data=gm_water, subset=leaflight=="shade-high", pch=16, col=temp, ylim=c(0,25), xlim=c(0,.5), 
     xlab=gmlab, ylab="")
points(Photo~gm, data=gm_water, subset=leaflight=="shade-low",pch=1, col=temp)
legend("topright", templab, pch=16,inset = 0.03, col=palette()) 
title(ylab=satlab, mgp=ypos, cex=1.2)


#leaf types
sun_gm <- gm_water[gm_water$leaf =="sun",]
shade_gm <- gm_water[gm_water$leaflight == "shade-low",]
lightson <- gm_water[gm_water$leaflight == "shade-high",]

#simple plots through time
plot(gm~campaign, data=sun_gm, pch=16, col=temp, ylim=c(0, .6), ylab="sun")
plot(gm~campaign, data=shade_gm, pch=16, col=temp, ylim=c(0, .6), ylab="shade")
plot(gm~campaign, data=lightson, pch=16, col=temp, ylim=c(0, .6), ylab="shade-high")


#means
gm_agg <- summaryBy(gm~ temp+leaf+light, data=gm_water,FUN=mean, keep.names=TRUE)
gm_drought_agg <- summaryBy(gm~ temp+leaf+light, data=gm_drought,FUN=mean, keep.names=TRUE)


##gm-temp
gm_ch<- summaryBy(gm+Photo+Cond+CTleaf ~id+chamber+temp+leaf+light+leaflight+Month, data=gm_water,FUN=mean,
                  keep.names=TRUE)

palette(c("blue", "red"))
   
##photosynthesis and temperature
plot(Photo~CTleaf, data=gm_ch, subset=leaflight=="sun-high", pch=16, col=temp, ylim=c(0,25), xlim=c(15, 40), 
     ylab="", xlab=leaftlab)
  points(Photo~CTleaf, data=gm_ch, subset=leaflight=="shade-low",pch=1, col=temp)
  legend("topright", templab, pch=16,inset = 0.03, col=palette()) 
  title(ylab=satlab, mgp=ypos, cex=1.2)

plot(gm~CTleaf, data=gm_ch, subset=leaflight=="sun-high", pch=16, col=temp, ylim=c(0,.5), xlim=c(15, 40), 
     ylab="", xlab=leaftlab)
points(gm~CTleaf, data=gm_ch, subset=leaflight=="shade-low",pch=1, col=temp)
legend("topright", templab, pch=16,inset = 0.03, col=palette()) 
title(ylab=gmlab, mgp=ypos, cex=1.2)


plot(Photo~gm, data=gm_ch, subset=leaflight=="sun-high", pch=16, col=temp, ylim=c(0,25), xlim=c(0,.5), 
     ylab="", xlab=gmlab)
points(Photo~gm, data=gm_ch, subset=leaflight=="shade-low",pch=1, col=temp)
legend("topright", templab, pch=16,inset = 0.03, col=palette()) 
title(ylab=satlab, mgp=ypos, cex=1.2)

plot(gm~Cond, data=gm_ch, subset=leaflight=="sun-high", pch=16, col=temp, ylim=c(0,.4), xlim=c(0,.4), 
     ylab="", xlab=gmlab)
points(gm~Cond, data=gm_ch, subset=leaflight=="shade-low",pch=1, col=temp)
legend("topright", templab, pch=16,inset = 0.03, col=palette()) 
title(ylab=condlab, mgp=ypos, cex=1.2)

###make a table of means and se of gm
tablenames <- c( "Leaf Type", "Light", "Temperature","Gm", "Gm(se)")

gm_dfr <- summaryBy(gm~ leaf+light+temp, data=gm_water,FUN=c(mean,se))
names(gm_dfr) <- tablenames

library(xtable)

gm_table <- xtable(gm_dfr)
digits(gm_table)[4:5] <- 4
print(gm_table, type='html')


```

